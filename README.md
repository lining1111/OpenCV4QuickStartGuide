# OpenCV4快速入门

    基于冯振版的《OpenCV4快速入门》编写的代码，基本与书中的代码一致。
    个人总结：在读这本书的时候，本人已经参与过一个全息路口的项目，负责边设备的开发工作，涉及设备管理，多路融合等业务需求。
    其中多路融合就需要本书10---12章的内容，当然目标检测和跟踪都是采用更高级别的模型进行了，比如yolov5和MOT。
    其实视频处理，尤其是涉及机器学习的部分，技术含量很高，对个人发展有利。
    通阅本书，了解基本的Opencv4操作，再结合实际项目中的算法模型，完成提升是一个不错的方向。

## chapter1

    工欲善其事，必先利其器。
    Image Watch 工具 是VSCode上的插件，用于查看图像。
    Clion上有 Opencv Image Viewer 工具，用于查看图像。

    OpenCV各模块说明
    
    calib3d：        相机标定相关
    core：           核心功能模块，主要包含opencv库的基础结构和基本操作。
    dnn：            深度学习模块
    features2d：     二维特征检测点检测、描述、匹配等
    flann：          最近邻匹配、聚类等。
    gapi：           该模块对图像处理算法做了加速处理
    highgui：        图像显示、按钮、鼠标等操作。
    imgcodecs：      负责图像文件读写，如图像读取与保存
    imgproc：        图像处理函数
    ml：             机器学习相关算法
    objdetect：      目标检测，包括Cascade face detector; latent SVM; HOG等
    photo：          用于计算摄影处理和恢复照片的算法
    stitching：      图像拼接，利用图像特征点进行图像拼接
    video：          视频处理，包括背景分割、视频跟踪等
    videoio：        负责视频文件的读取和写入

## chapter2

    VideoWrite中有打开摄像头的动作，由于代码是在虚拟机中，其实虚拟机是要做如下操作的
    1、在VM的右下角，将摄像头设备接入到虚拟机内，这时在终端输入 ls /dev/video tab后会有相应的设备符出现
    2、在VM中的虚拟机->设置中，将usb设备的兼容性这里改为usb3.1，如果不做，即使1做了也会出现打不开设备的情况

    ubuntu中安装cheese,打开摄像头。
    其实也可以在系统中安装ros2,用ros2打开摄像头。安装ros2除了可以进行机器人开发外，其实它的数据统一及分发思想对编程是有帮助的

## chapter3

    仿射变换---图形的旋转    确定旋转角度和旋转中心，之后确定旋转矩阵，最终通过仿射变换(warpAffine())完成图形旋转
        仿射变换就是图像的旋转、平移和缩放操作的统称，可以表示为线性变换和平移变换的叠加。
        仿射变换的数学表示就是先乘以一个线性变换矩阵，再加上一个平移向量，其中线性变换矩阵为2x2的矩阵，平移向量为2x1的向量。
        仿射变换的矩阵形式如下：
        M = [a, b; c, d]
        T = [tx, ty]
        M*[x, y] + T = [ax + bx + tx, cx + dy + ty]

    透视变换---图像的投影    按照物体成像投影规律进行变换，即将物体重新投影到新的成像平面。
        通过透视变换实现对物体图像的校正，在透视变换中，透视前的图像和透视后的图像之间变换关系可以用一个3x3的矩阵表示，
        该矩阵可以通过两幅图像中的4个对应点的坐标求取，因此透视变换又称作四点变换。getPerspectiveTransform()函数用于求取透视变换矩阵。
        调用warpPerspective()函数完成透视变换。
    
    OpenCV中图像的深拷贝和浅拷贝：深拷贝copyTo()不对原图进行修改，而浅拷贝copy()会对原图进行修改。

    高斯金字塔，大尺寸-->小尺寸，pyrDown()函数实现
    拉普拉斯金字塔，小尺寸-->大尺寸，pyrUp()函数实现

## chapter4

## chapter5

    图像卷积，卷积核是图像处理中常用的工具，卷积核可以实现图像的平滑、锐化、边缘检测、图像滤波等操作。
    OpenCV中卷积核的定义：
    Mat kernel(rows, cols, CV_32F, Scalar(0));
    其中rows和cols分别表示卷积核的行数和列数，CV_32F表示卷积核的数据类型，Scalar(0)表示卷积核的初始值。

    图像噪声：
    椒盐噪声：随机将图像像素点上的像素值变为0或255
    高斯噪声：高斯分布的随机噪声
    乘性噪声：图像像素点上的像素值乘以一个随机数
    泊松噪声：图像像素点上的像素值服从泊松分布

    边缘检测：
    Sobel算子：
    Scharr算子：
    Canny算子：

## chapter6

    图像像素距离：
    欧拉距离：两个像素点之间的直线距离
    街区距离：两个像素点之间的X、Y坐标的距离之和
    棋盘距离：两个像素点X、Y距离的最大值

    图像连通域：图像中具体相同像素值并且位置相邻的像素点集合称为连通域。
    连通域分析：在图像中，对连通域进行分析和处理，可以实现对图像的分割、填充、连接等操作。应用场景：车牌识别、文字识别、目标检测等

    图像形态学应用：
    开运算：先进行腐蚀操作，再进行膨胀操作。消除噪声点，去除小的连通域，保留大的连通域。
    闭运算：先进行膨胀操作，再进行腐蚀操作。填充小的连通域，消除大的连通域。
    形态学梯度：基本梯度、内部梯度、外部梯度。
    顶帽运算：原图像与开运算结果的差。
    底帽运算：原图像与闭运算结果的差。
    图像细化：将图像的线条从多像素宽度减少为单位像素宽度。常在文字识别中使用。
    
## chapter7

    目标检测

    HOG特征：HoughLines() HoughLinesP()
    Canny边缘检测：Canny()
    轮廓检测：
    
    距的计算：几何距、中心距、Hu距

    二维码检测，因为是apt安装的opencv,所以没有qrcode模块，需要自己安装,通过libzbar代替,修改了源码

## chapter8

    图像分割：漫水填充法、分水岭法、Grabcut法、Mean-Shift法
    图像修复：inpaint()

## chapter9

    特征点：

## chapter10

    矩阵的知识储备：
    矩阵为mxn的二维数组，其中m为行数，n为列数。
    矩阵的点乘,Dot(),要求两个矩阵的行向量或列向量相等，或者同时相等，矩阵对应各元素相乘
    矩阵的叉乘，Multiply(),要求两个矩阵的维度相同，即mxn和nxm 得到mxm的矩阵，中间相同留两边

    坐标系：
    --- 右手坐标系：是在空间中规定直角坐标系的方法之一。 
        此坐标系中x轴，y轴和z轴的正方向是如下规定的：
        把右手放在原点的位置，使大拇指，食指和中指互成直角，
        把大拇指指向x轴的正方向，食指指向y轴的正方向时，中指所指的方向就是z轴的正方向
    --- 左手坐标系：是在空间中规定直角坐标系的方法之一。
        此坐标系中x轴，y轴和z轴的正方向是如下规定的：
        把左手放在原点的位置，使大拇指，食指和中指互成直角，
        把大拇指指向x轴的正方向，食指指向y轴的正方向时，中指所指的方向就是z轴的正方向

    笛卡尔坐标系为右手坐标系
### 单目相机标定
    立体视觉：
    相机的内参系数：反映了环境信息到图像信息之间的映射关系
    ===相机内参
    ---下面的是二维正对图像视角(左手坐标系)
    像素坐标系：一幅图像在计算机存储中不同像素点的坐标，其原点位于图像左上角，x轴(u)向右，y轴(v)向下。
    图像坐标系：图像坐标系是图像像素点在图像中的位置，原点位于图像的中心，x轴向右，y轴向下。
    像素坐标系到图像坐标系的转换：见书P324
    假设点P,像素坐标系为P_pixel(u,v),图像坐标系为P_pic(x,y),则有：
    
    u =  x/dx + u0
    v = y/dy + v0
    
    其中
    dx 表示一个像素的物理宽度,
    dy 表示一个像素的物理高度,
    u0=width/2,(width为图像的宽度),
    v0=height/2,(height为图像的高度),
    后续为了方便计算，用齐次坐标表示
        C = [1/dx,0,u0;
            0,1/dy,v0;
            0,0,1]

    像素坐标    vecPixel = [u,v,1]
    图片坐标    vecPic = [x,y,1]
            vecPixel = C * vecPic(叉乘)---------------------------(1)

    相机坐标系：用来描述相机观测环境和相机之间相对位姿关系的参考系。(右手坐标系)
    单目相机模型，多采用针孔模型进行描述，针孔模型中，(右手坐标系)相机坐标系的原点位于相机的光心，x轴向右，y轴向下，z轴垂直于成像平面。
    真实点位于z轴正向，图像点位于z轴负向。
    通过小孔成像模型，可以得到图像坐标系和相机坐标系之间的转换关系。
    P_camera(xc,yc,zc) P_pic(x,y,1),求点的映射关系，可以通过两个平面zx,zy分别求得x轴,y轴的映射关系
    相机的焦距为f(平行光从透镜的光心入射时，透镜光心到光聚集之焦点的距离)
    x = f*xc/zc
    y = f*yc/zc
    即有下面的齐次坐标表示
    vecCamera = [xc,yc,zc]
    vecPic = [x,y,1]
    K1 = [f,0,0;
        0,f,0;
        0,0,1]

    zc*vecPic = K1 * vecCamera(叉乘)-------------------------------(2)

    综合上面的(1)(2)得到

    zc*vecPixel = zc* C * vecPic = C*K1*vecCamera(叉乘)
    整理得到
    C*K1=K = [fx,0,u0;
            0,fy,v0;
            0,0,1]

    zc*vecPic = K*vecCamera(叉乘)------------------------------------(3)
    其中 
    fx=f/dx,
    fy=f/dy,
    u0=width/2,
    v0=height/2,
    f 为焦距，
    dx 表示一个像素的物理宽度,
    dy 表示一个像素的物理高度,

    可以看出K只与相机的内部参数相关，因此K为相机内参矩阵
    
    ===相机外参
    假设点P 世界坐标系P_world(xw,yw,zw),相机坐标系P_camera(xc,yc,zc),
    
    相机坐标系到世界坐标系：
    相机外参矩阵：P331 矩阵R、t R为3x3的旋转矩阵，t为3x1的平移向量
    ---相机外参矩阵：
        R = [R11,R12,R13;
            R21,R22,R23;
            R31,R32,R33]
        t = [t1,t2,t3]
    vecWorld = [xw,yw,zw,1]
    vecCamera = [xc,yc,zc]
    vecCamera = R*vecWorld + t
    整理下得到
    vecCamera = [R t]*(vecWorld,1)--------------------------------------(4)
    综合(3)(4)得到
    zc*vecPic = K*[R t]*(vecWorld,1)------------------------------------(5) 注意这里修订了书中P332中(10-8)的公式

    
    ===相机畸变
    单目相机的标定：calibrateCamera(),参考程序myCalibrateCamera
    
### 双目视觉

    双目标定：steroCalibrate(),参考程序myStereoCalibrate

## chapter11

    目标跟踪

## chapter12

    机器学习